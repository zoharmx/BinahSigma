# Binah-Î£ v2.0 - Deployment Guide

## ðŸš€ Deployment Options

Choose the option that best fits your needs:

1. **Railway** (Recommended for quick start) - $5/month
2. **Render** (Good free tier) - Free/$7/month
3. **Docker + Cloud** (Most flexible) - Variable cost
4. **Fly.io** (Good for global deployment) - $1.94/month minimum

---

## Option 1: Railway (Easiest - 5 minutes)

### Prerequisites
- GitHub account
- Railway account (https://railway.app)
- Your API keys ready

### Steps

#### 1. Push to GitHub

```bash
# Initialize git (if not already done)
git init
git add .
git commit -m "Initial Binah-Sigma v2.0 deployment"

# Create GitHub repo and push
git remote add origin https://github.com/YOUR_USERNAME/binah-sigma.git
git branch -M main
git push -u origin main
```

#### 2. Deploy to Railway

1. Go to https://railway.app
2. Click "New Project"
3. Choose "Deploy from GitHub repo"
4. Select your `binah-sigma` repository
5. Railway will auto-detect the Dockerfile

#### 3. Set Environment Variables

In Railway dashboard:
- Click on your service
- Go to "Variables" tab
- Add these variables:

```
MISTRAL_API_KEY=cqrcNINDiUWdfsRkUk9BBCq52XzphD1V
GEMINI_API_KEY=AIzaSyBxSQ6GGcujsIqNznxNQjJt-kKG4Wcuogo
DEEPSEEK_API_KEY=sk-181034ba355c4292ad7f149d569ce4e7
JWT_SECRET_KEY=[Generate new with command below]
ENVIRONMENT=production
INIT_DEMO_KEYS=false
```

**Generate strong JWT secret:**
```bash
python -c "import secrets; print(secrets.token_urlsafe(32))"
```

#### 4. Deploy

Railway will auto-deploy. You'll get a URL like:
```
https://binah-sigma-production.up.railway.app
```

#### 5. Test

```bash
curl https://YOUR-RAILWAY-URL.railway.app/health
```

**Expected response:**
```json
{"status": "healthy", "version": "2.0.0"}
```

---

## Option 2: Render (Good Free Tier)

### Prerequisites
- GitHub account
- Render account (https://render.com)

### Steps

#### 1. Push to GitHub (same as Railway)

#### 2. Deploy to Render

1. Go to https://render.com
2. Click "New +" â†’ "Web Service"
3. Connect your GitHub repository
4. Render will detect `render.yaml`

#### 3. Configure

Render will use `render.yaml` but you need to set secret env vars:

1. Go to your service dashboard
2. Environment â†’ Add Secret Files
3. Add these:

```
MISTRAL_API_KEY=cqrcNINDiUWdfsRkUk9BBCq52XzphD1V
GEMINI_API_KEY=AIzaSyBxSQ6GGcujsIqNznxNQjJt-kKG4Wcuogo
DEEPSEEK_API_KEY=sk-181034ba355c4292ad7f149d569ce4e7
```

JWT_SECRET_KEY will be auto-generated by Render.

#### 4. Deploy

Click "Create Web Service"

You'll get URL like:
```
https://binah-sigma.onrender.com
```

**Note**: Free tier sleeps after 15 min of inactivity (cold starts).

---

## Option 3: Docker + DigitalOcean/AWS/Azure

### Prerequisites
- Docker installed
- Cloud account (DigitalOcean, AWS, Azure, etc.)

### Local Testing First

#### 1. Create production environment file

```bash
cd backend
cp .env.production.example .env.production

# Edit with your values
nano .env.production  # or use any text editor
```

Fill in:
```bash
JWT_SECRET_KEY=$(python -c "import secrets; print(secrets.token_urlsafe(32))")
MISTRAL_API_KEY=cqrcNINDiUWdfsRkUk9BBCq52XzphD1V
GEMINI_API_KEY=AIzaSyBxSQ6GGcujsIqNznxNQjJt-kKG4Wcuogo
DEEPSEEK_API_KEY=sk-181034ba355c4292ad7f149d569ce4e7
ENVIRONMENT=production
INIT_DEMO_KEYS=false
```

#### 2. Build and test locally

```bash
# Build image
docker build -t binah-sigma:latest backend/

# Run locally
docker run -d \
  --name binah-sigma \
  --env-file backend/.env.production \
  -p 8000:8000 \
  binah-sigma:latest

# Test
curl http://localhost:8000/health
```

#### 3. Deploy to Cloud

##### DigitalOcean App Platform

1. Push to GitHub
2. Go to DigitalOcean Apps
3. Create new app from GitHub
4. Select Dockerfile
5. Add environment variables
6. Deploy

##### AWS Elastic Beanstalk

```bash
# Install EB CLI
pip install awsebcli

# Initialize
eb init -p docker binah-sigma

# Create environment
eb create binah-sigma-prod

# Set environment variables
eb setenv \
  MISTRAL_API_KEY=xxx \
  GEMINI_API_KEY=xxx \
  DEEPSEEK_API_KEY=xxx \
  JWT_SECRET_KEY=xxx

# Deploy
eb deploy
```

##### Azure Container Instances

```bash
# Login
az login

# Create resource group
az group create --name binah-sigma --location eastus

# Create container
az container create \
  --resource-group binah-sigma \
  --name binah-sigma-api \
  --image binah-sigma:latest \
  --dns-name-label binah-sigma \
  --ports 8000 \
  --environment-variables \
    MISTRAL_API_KEY=xxx \
    GEMINI_API_KEY=xxx \
    DEEPSEEK_API_KEY=xxx \
    JWT_SECRET_KEY=xxx
```

---

## Option 4: Fly.io (Global Edge Deployment)

### Prerequisites
- Fly.io account (https://fly.io)
- flyctl CLI installed

### Steps

#### 1. Install flyctl

```bash
# macOS/Linux
curl -L https://fly.io/install.sh | sh

# Windows (PowerShell)
powershell -Command "iwr https://fly.io/install.ps1 -useb | iex"
```

#### 2. Login and Initialize

```bash
fly auth login

cd backend
fly launch
```

Answer prompts:
- App name: `binah-sigma` (or your choice)
- Region: Choose closest to your users
- Postgres: No (for now)
- Redis: No (for now)

#### 3. Set Secrets

```bash
fly secrets set \
  MISTRAL_API_KEY=cqrcNINDiUWdfsRkUk9BBCq52XzphD1V \
  GEMINI_API_KEY=AIzaSyBxSQ6GGcujsIqNznxNQjJt-kKG4Wcuogo \
  DEEPSEEK_API_KEY=sk-181034ba355c4292ad7f149d569ce4e7 \
  JWT_SECRET_KEY=$(python -c "import secrets; print(secrets.token_urlsafe(32))") \
  ENVIRONMENT=production \
  INIT_DEMO_KEYS=false
```

#### 4. Deploy

```bash
fly deploy
```

Your app will be at: `https://binah-sigma.fly.dev`

---

## ðŸ”’ Security Checklist

Before going to production, ensure:

### Critical
- [ ] Changed `JWT_SECRET_KEY` from default
- [ ] Set `INIT_DEMO_KEYS=false`
- [ ] All API keys are set via environment variables (not hardcoded)
- [ ] `.env` and `.env.production` are in `.gitignore`
- [ ] CORS is restricted to your frontend domain (not `*`)
- [ ] HTTPS is enabled (automatic on most platforms)

### Important
- [ ] Enable rate limiting with Redis (production-ready)
- [ ] Set up error monitoring (Sentry)
- [ ] Configure logging (CloudWatch, Datadog, etc.)
- [ ] Set up uptime monitoring (UptimeRobot, Pingdom)
- [ ] Database for API key storage (PostgreSQL)
- [ ] Implement API key rotation
- [ ] Add request/response logging

### Recommended
- [ ] Set up CI/CD pipeline
- [ ] Configure auto-scaling
- [ ] Set up backup strategy
- [ ] Implement metrics dashboard
- [ ] Add load balancing
- [ ] Configure CDN for frontend

---

## ðŸ“Š Post-Deployment

### 1. Update CORS

Edit `backend/main_v2.py`:

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://your-frontend-domain.com",  # Your actual frontend
        "http://localhost:3000"  # Development only
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 2. Update Frontend

Edit `frontend/index_v2.html`:

```javascript
// Change from localhost to production URL
const API_URL_V1 = 'https://YOUR-PRODUCTION-URL/binah-sigma/analyze';
const API_URL_V2 = 'https://YOUR-PRODUCTION-URL/v2/analyze';
```

### 3. Test Production API

```bash
# Health check
curl https://YOUR-PRODUCTION-URL/health

# Test with API key
curl -X POST https://YOUR-PRODUCTION-URL/v2/analyze \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "context": "Production test",
    "decision_question": "Is deployment successful?",
    "stakeholders": ["users", "team"],
    "constraints": ["time", "resources"],
    "time_horizon": "immediate",
    "provider": "mistral",
    "industry": "technology"
  }'
```

### 4. Monitor

Set up monitoring for:
- Response times
- Error rates
- API usage
- Rate limit hits
- Provider failovers

---

## ðŸš¨ Troubleshooting

### "Module not found" errors
- Check `requirements.txt` is in correct location
- Verify build command includes `pip install -r requirements.txt`

### "Connection refused"
- Ensure app binds to `0.0.0.0` not `127.0.0.1`
- Check port is `$PORT` environment variable

### "Unauthorized" errors
- Regenerate API keys with production JWT_SECRET_KEY
- Verify Authorization header format: `Bearer <token>`

### "Rate limit" errors
- Increase tier limits in production
- Implement Redis for distributed rate limiting

### High latency
- Enable multiple workers (`--workers 2` or more)
- Use provider with lowest latency for your region
- Enable caching for repeated requests

---

## ðŸ’° Cost Estimates

### Railway
- **Free tier**: $5 credit/month
- **Hobby**: $5/month (includes $5 credit)
- **Pro**: $20/month
- **Estimated for Binah-Î£**: ~$10-20/month

### Render
- **Free**: $0 (with sleep)
- **Starter**: $7/month
- **Standard**: $25/month
- **Estimated for Binah-Î£**: $7-25/month

### DigitalOcean
- **Basic Droplet**: $4/month
- **App Platform**: $5/month
- **Estimated for Binah-Î£**: $12-24/month

### Fly.io
- **Free allowance**: 2,340 hours/month
- **Excess**: $0.0000008/second
- **Estimated for Binah-Î£**: $1.94-10/month

### AWS/Azure/GCP
- **Variable**: $20-100/month depending on usage

**LLM API Costs** (separate):
- Mistral: ~$0.002-0.01 per request
- Gemini: ~$0.001-0.005 per request
- DeepSeek: ~$0.0002-0.001 per request

**Total estimated monthly cost**:
- Small scale (100 requests): $10-30/month
- Medium scale (1,000 requests): $30-100/month
- Large scale (10,000 requests): $100-500/month

---

## âœ… Recommended: Railway (Easiest)

For most users, I recommend **Railway** because:

1. âœ… Simplest deployment (5 minutes)
2. âœ… Auto-detects Dockerfile
3. âœ… Built-in HTTPS
4. âœ… Easy environment variable management
5. âœ… Automatic deployments from GitHub
6. âœ… Good free tier ($5 credit)
7. âœ… Excellent observability

---

**You're ready for production! ðŸš€**

Choose your platform and follow the steps above.
